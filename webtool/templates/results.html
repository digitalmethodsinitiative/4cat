{% extends "layout.html" %}

{% block title %}Datasets &amp; previous results{% endblock %}
{% block body_class %}result-list plain-page{% endblock %}

{% block body %}
    <nav class="view-controls block">
        <form action="{{ url_for("admin_frontpage") }}" method="GET">
            <input type="hidden" name="depth" value="{{ depth }}">
            <ul>
                <li><input aria-label="Query filter" placeholder="Filter queries..." name="filter"
                           value="{{ filter }}"></li>
            </ul>
            <button>Filter</button>
        </form>
    </nav>
    <article>
        <section>
            <h2><span>Recently created datasets</span></h2>
            <nav class="tabs">
                <ul>
                    <li{% if depth == "all" %} class="current"{% endif %}><a href="{{ url_for('show_results') }}?{{ filter|http_query }}&amp;depth=all">All datasets</a></li>
                    <li{% if not depth or depth == "own" %} class="current"{% endif %}><a href="{{ url_for('show_results') }}?{{ filter|http_query }}&amp;depth=own">My own datasets</a></li>
                    <li{% if depth == "favourites" %} class="current"{% endif %}><a href="{{ url_for('show_results') }}?{{ filter|http_query }}&amp;depth=favourites">Favourites only</a></li>
                </ul>
            </nav>
        {% if datasets %}
            <ol class="result-list">
                {% for dataset in datasets %}{% if dataset.key_parent in ("", None) %}
                    <li id="{{ dataset.key }}"
                        class="result{% if dataset.is_finished() %} {% if dataset.num_rows > 0 %}has_results{% else %}no_results{% endif %}{% else %} dataset-unfinished{% endif %}"
                        data-numrows="{{ dataset.num_rows }}" data-key="{{ dataset.key }}">

                        <div class="property-container">
                            <div class="result">
                                <a href="{{ url_for('show_result', key=dataset.key) }}"><i class="fas fa-link" aria-label="Permalink" title="Permalink"></i><span class="sr-only">show result</span></a>
                                <span class="property-badge">{{ dataset.parameters.datasource if "datasource" in dataset.parameters else "4chan" }}{% if "board" in dataset.parameters and dataset.parameters.board %}/{{ dataset.parameters.board }}/{% endif %}</span>
                                <h4>{{ dataset.get_label() }}</h4>
                                {% if dataset.is_finished() %}
                                    <span class="result">({{ "{:,}".format(dataset.num_rows) }} item{% if dataset.num_rows != 1 %}s{% endif %})</span>
                                {% endif %}
                            </div>
                            <div>{% include 'result-metadata.html' %}</div>
                        </div>

                        <div class="property-container status">
                        {% if not dataset.is_finished() or dataset.num_rows == 0 %}
                            <p class="button-like inactive"><span class="dataset-status">{% include "result-status.html" %}</span></p>
                        {% else %}
                            <a class="button-like" href="{{ url_for('get_result', query_file=dataset.result_file)[:-1] }}"><i class="fas fa-download" aria-hidden="true"></i> {{ dataset.get_results_path()|filesize }}, {{ dataset.result_file.split(".")[-1] }}</a>
                        {% endif %}
                        </div>

                        {% if dataset.is_finished() and dataset.num_rows > 0 %}
                            <div class="property-container analysis">
                                <a class="button-like processor-link" href="{{ url_for('show_result', key=dataset.key) }}">Analysis{% if dataset.children|length > 0 %} (+{{ dataset.children|length }}){% endif %}</a>
                            </div>
                        {% endif %}
                    </li>
                {% endif %}{% endfor %}
            </ol>
        {% else %}
            <p class="banner">No datasets available.{% if depth == "favourites" %} You can mark datasets as 'favourite'
                to easily find them in this view.{% endif %}</p>
        {% endif %}
        </section>
    </article>
    {% include "components/pagination.html" %}
{% endblock %}

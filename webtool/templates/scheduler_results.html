{% extends "layout.html" %}

{% block title %}Scheduled Datasets{% endblock %}
{% block body_class %}result-list plain-page{% endblock %}
{% block breadcrumbs %}{% set navigation.current = "dataset" %}{% endblock %}

{% block body %}
    <article>
        <section>
            <h2><span>Scheduled Datasets</span></h2>
            {% if datasets %}
                <ol class="result-list">
                {% for dataset in datasets %}
                    <li id="{{ dataset.key }}"
                    class="result{% if dataset.is_finished() %} {% if dataset.num_rows > 0 %}has_results{% else %}no_results{% endif %}{% else %} dataset-unfinished{% endif %}"
                    data-numrows="{{ dataset.num_rows }}" data-key="{{ dataset.key }}">

                    <div class="property-container">
                        <div class="result">
                            <a href="{{ url_for('dataset.show_result', key=dataset.key) }}"><i class="fas fa-link" aria-label="Permalink" title="Permalink"></i><span class="sr-only">show result</span></a>
                            {% if __user_config("ui.show_datasource") %}<span class="property-badge">{{ dataset.parameters.datasource if "datasource" in dataset.parameters else "4chan" }}{% if "board" in dataset.parameters and dataset.parameters.board %}/{{ dataset.parameters.board }}/{% endif %}</span>{% endif %}
                            <h4>{{ dataset.get_label() }}</h4>
                            {% if dataset.is_finished() %}
                                <span class="result">({{ "{:,}".format(dataset.num_rows) }} item{% if dataset.num_rows != 1 %}s{% endif %})</span>
                            {% endif %}
                            {% if dataset.is_finished() and dataset.get_last_update() %}
                                <span>Finished:</span>
                                <span>{{ dataset.get_last_update().timestamp()|int|datetime(fmt="%d %B %Y, %H:%M")|safe }}</span>
                            {% else %}
                                <span>Created:</span>
                                <span>
                                    {% if dataset.parameters.original_timestamp %}
                                        <i class="fa fa-file-import tooltip-trigger" aria-hidden="true" aria-controls="tooltip-{{ dataset.key }}-imported"></i> <span class="sr-only">This dataset was imported and was originally created on {{ dataset.parameters.original_timestamp|datetime(fmt="%d %B %Y, %H:%M")|safe }}.</span>
                                        <span role="tooltip" aria-hidden="true" id="tooltip-{{ dataset.key }}-imported">This dataset was imported and was originally created on {{ dataset.parameters.original_timestamp|datetime(fmt="%d %B %Y, %H:%M")|safe }}.</span>
                                    {% endif %}
                                    {{ dataset.timestamp|datetime(fmt="%d %B %Y, %H:%M")|safe }}
                                </span>
                            {% endif %}
                        </div>
                        <div>{% include 'components/result-metadata.html' %}</div>
                    </div>

                    <div class="property-container status">
                    {% if not dataset.is_finished() or dataset.num_rows == 0 %}
                        <p class="button-like inactive{% if dataset.progress and dataset.progress > 0 and not dataset.is_finished() %} progress progress-{{ (dataset.progress * 100)|round(0)|int }}{% endif %}"><span class="dataset-status">{% include "components/result-status.html" %}</span></p>
                    {% else %}
                        <a class="button-like" href="{{ url_for('dataset.get_result', query_file=dataset.result_file) }}"><i class="fas fa-download" aria-hidden="true"></i> {{ dataset.get_results_path()|filesize }}, {{ dataset.result_file.split(".")[-1] }}</a>
                    {% endif %}
                    </div>

                    {% if dataset.is_finished() and dataset.num_rows > 0 %}
                        <div class="property-container analysis">
                            <a class="button-like processor-link" href="{{ url_for('dataset.show_result', key=dataset.key) }}">Analysis{% if dataset.children|length > 0 %} (+{{ dataset.children|length }}){% endif %}</a>
                        </div>
                    {% endif %}
                </li>

            {% endfor %}
            </ol>
            {% else %}
                <p class="banner">No{% if depth == "current" %} currently{% endif %} scheduled jobs available.</p>
            {% endif %}
        </section>
    </article>
    {% include "components/pagination.html" %}
{% endblock %}
